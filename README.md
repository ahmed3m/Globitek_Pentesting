# Project 8 - Pentesting Live Targets

Time spent: **12** hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:
* Username Enumeration
* Insecure Direct Object Reference (IDOR)
* SQL Injection (SQLi)
* Cross-Site Scripting (XSS)
* Cross-Site Request Forgery (CSRF)
* Session Hijacking/Fixation

Each version of the site has been given two of the six vulnerabilities. (In other words, all six of the exploits should be assignable to one of the sites.)

## Blue

Vulnerability #1: SQL Injection (SQLi)

There's an SQLi vulnerability in the id parameter for the salesperson. I used a blind SQLi `' OR SLEEP(5)=0--'` to trigger it.

<img src='http://i.imgur.com/rqPJLok.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

Vulnerability #2: Session Hijacking/Fixation

For the session hijacking, the attacker (on the right) was able to retrieve the PHPSESSID of the logged in admin (on the left). Using that PHPSESSID allowed the attacker to login.

<img src='http://i.imgur.com/H85UxPy.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

For the session fixation, the attacker (on the right) was able to change the PHPSESSID for the logged in admin (on the left); therefore, allowing both the attacker and the admin to use the same session id which allows the attacker to login.

<img src='http://i.imgur.com/LT88mrc.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

## Green

Vulnerability #1: User Enumeration

The site contains a vulnerability as it allows us to figure out which users already exist. If they already exist, the error message was given in bold. If the username does not exist, the error message wasn't bold. This can give us valuable information on which usernames exist.

<img src='http://i.imgur.com/8hWwYIf.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

Vulnerability #2: Cross-Site Scripting (XSS)

One of the input fields is not sanitized when being outputted, which allows for a stored XSS. 

<img src='http://i.imgur.com/uAVWykG.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

## Red

Vulnerability #1: Insecure Direct Object Reference (IDOR)

One of the inputs in this site allows us to directly change it and access information that shouldn't be displayed.

<img src='http://i.imgur.com/n8lVumJ.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

Vulnerability #2: Cross-Site Request Forgery (CSRF)

We can forge a form that will automatically do changes if a logged-in admin were to open it. The following shows the code neeeded. 

```
<!DOCTYPE html>
<html>
  <head>
    <title>Fake User Edit Form</title>
  </head>
  <body onload="document.user_edit_form.submit()">
    <form action="https://104.197.15.70/red/public/staff/users/edit.php?id=1" method="POST" name="user_edit_form" style="display: none;" target="hidden_results">
      <input type="text" name="first_name" value="Jim">
      <input type="text" name="last_name" value="Munroe">
      <input type="text" name="username" value="jmonroe99">
      <input type="text" name="email" value="test@test.com">
      <input type="password" name="previous_password" value="">
      <input type="password" name="password" value="">
      <input type="password" name="confirm_password" value="">
    </form>
    <iframe name="hidden_results" style="display: none;"></iframe>
  </body>
</html>
```

<img src='http://i.imgur.com/yYRMkuv.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

## Bonus

1. [X] Bonus Objective 1: Build on the SQLi

Using sqlmap, I was able to retrieve all kinds of information including the databases used such globitek_blue, globitek_green, and globitek_red. I was also able to see the tables in the databases such as users, feedback,  countries, failed_logins, salespeople, salespeople_territories, states, and territories. I was also able to access the information inside the tables.

<img src='http://i.imgur.com/mATmNKo.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />


2. [X] Bonus Objective 2: Build on XSS

Using XSS, I can do many things including redirecting to a new page, stealing cookies, and many others. The following shows how I used XSS to redirect to google. I can also redirect to another page that will store the cookies in order to retrieve the session id and be able to login.

<img src='http://i.imgur.com/nOU6IMG.gif' title='Video Walkthrough' width='' alt='Video Walkthrough' />

## Notes

The main challenge I had was with sqlmap as I needed to get familiar with the tool and its different parameters. It was also causing me issues as I wrote down `?id=1` in the URL which didn't allow sqlmap to see the vulnerability. When I changed it to `?id=*` instead, it worked fine and found the vulnerability.
